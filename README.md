# 法律考試題庫系統 - 優化版

## 最新更新（2024 年 7 月）

### 1. Chroma 數據庫接口兼容性更新

- **接口適配**：適配 ChromaDB 0.4.16+版本的新嵌入函數接口要求
- **兼容層實現**：為 SentenceTransformer 添加包裝器，確保與新接口兼容
- **穩定性提升**：改進多階段降級策略，確保系統在不同環境下穩定運行

## 最新優化（2024 年 7 月）

為了更好地適應 Gemini API 的免費版配額限制，我們對系統進行了以下優化：

### 1. 嵌入模型優化

- **模型選擇**：優先使用 `gemini-embedding-exp` 模型，配備自動降級機制
- **批次處理**：優化批次大小為 8，適合 Gemini API 的限流策略
- **錯誤處理**：實現指數退避策略，根據模型類型自動調整重試間隔
- **本地備用**：失敗時自動降級至本地 SentenceTransformer 模型

### 2. 元數據提取優化

- **批次策略**：根據免費配額配置靈活的批次大小（小批量 10，標準 25，大批量 30）
- **模型選擇**：優先使用 `gemini-2.0-flash`（高 RPM 限制），備用 `gemini-1.5-flash`
- **智能降級**：基於成功率動態切換到 OpenAI 或本地提取
- **質量評估**：添加元數據質量評分系統，確保提取結果的質量

### 3. API 使用優化

- **配額感知**：自動調整請求策略以保持在免費配額限制內
- **錯誤處理**：完善的錯誤處理和降級策略，提高系統穩定性
- **多模式支持**：向量庫支持多種初始化模式，確保系統可靠性

## 系統啟動

```bash
# 後端服務啟動
cd backend
python main.py

# 前端服務啟動
cd frontend
npm start
```

## 配額使用建議

- **Gemini 2.0 Flash**: 適用於法律元數據提取（每分鐘 2000 次請求限制）
- **Gemini 嵌入模型**: 每分鐘限制 10 次，建議小批量處理
- **文件上傳**: 推薦單次上傳文件不超過 50 題，避免觸發限流

## 注意事項

- 系統會自動監控 API 使用情況，並在接近限制時啟用智能降級機制
- 如果遇到頻繁的 API 配額錯誤，建議適當增加批次間的等待時間
- 本地備用模式需要安裝相關依賴（sentence-transformers）
